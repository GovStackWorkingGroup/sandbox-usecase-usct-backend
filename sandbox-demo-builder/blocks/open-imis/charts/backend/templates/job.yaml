apiVersion: batch/v1
kind: Job
metadata:
  name: openimis-migrate
spec:
  template:
    spec:
      containers:
        - name: migrate
          image: {{ .Values.deployment.containers.image }}
          command: ["/bin/bash", "/scripts/entrypoint.sh", "manage", "migrate"]
          volumeMounts:
            - name: script-volume
              mountPath: /scripts/entrypoint.sh
              subPath: entrypoint.sh
              readOnly: true
      restartPolicy: OnFailure
      volumes:
        - name: script-volume
          configMap:
            name: openimis-script
